!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).lib=e()}(this,function(){"use strict";e.prototype.onClick=function(t,e,i){t.clearRect(0,0,e,i),this.draw(t,e,i)},e.prototype.randomRgb=function(){var t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),i=Math.floor(256*Math.random());return"rgb(".concat(t,",").concat(e,",").concat(i,")")},e.prototype.randomChar=function(t){void 0===t&&(t=4);for(var e="",i=0;i<t;i++)e+=this.factorStr[Math.floor(Math.random()*this.factorStr.length)];return e},e.prototype.draw=function(t,e,i){if(t.strokeStyle=this.randomRgb(),this.isLine)for(var n=0;n<10;n++)t.beginPath(),t.moveTo(Math.random()*e,Math.random()*i),t.lineTo(Math.random()*e,Math.random()*i),t.strokeStyle=this.randomRgb(),t.stroke();if(this.isPoint)for(var o=0;o<20;o++){t.beginPath();var s=Math.random()*e,r=Math.random()*i;t.arc(s,r,1,0,2*Math.PI,!0),t.fillStyle=this.randomRgb(),t.fill()}for(var a="",h=0;h<this.charNum;h++){t.save();var s=e/this.charNum*h/2,r=Math.random()*i/4+i/4,c=(t.translate(s,r),this.randomChar(1));a+=c,t.font="italic ".concat(this.fontSize,"px 'Microsoft YaHei'"),this.isFill?(t.fillStyle=this.randomRgb(),t.fillText(c,s,r)):(t.strokeStyle=this.randomRgb(),t.strokeText(c,s,r)),t.restore()}this.callback(a)};var t=e;function e(t,e){var i=this,n=(this.callback=e,this.isLine=t.line,this.isPoint=t.point,this.isFill=t.fill,this.fontSize=t.fontSize||50,this.charNum=t.charNum||4,this.factorStr=t.factor||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",document.createElement("canvas")),o=(n.width=t.container.clientWidth,n.height=t.container.clientHeight,t.container.appendChild(n),n.getContext("2d"));n.onclick=function(){return i.onClick(o,n.width,n.height)},this.draw(o,n.width,n.height)}n.prototype.getMaterials=function(t){var e=document.createElement("div"),i=(e.style.cssText="user-select: none;\n    position: relative;\n    background-color: #E8E8E8;",document.createElement("div")),n=(i.style.cssText='position: absolute;\n    top: 0;\n    left: 0;\n    width: 36px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: #fff;\n    cursor: pointer;\n    font-family: "宋体";\n    z-index: 1;\n    font-weight: bold;\n    color: #929292;',i.innerText=">>",document.createElement("div")),t=(n.style.cssText="position: absolute;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 13px;\n    color: #444;",n.innerText=t,document.createElement("div"));return t.style.cssText="background-color: #BFBFBF;\n    height: 100%;\n    position: absolute;\n    left: 0;",e.appendChild(t),e.appendChild(i),e.appendChild(n),{container:e,slider:i,titleDiv:n,bgDiv:t}},n.prototype.init=function(e){var i,n,o=this,t=this.getMaterials(e.title),s=t.container,r=t.slider,a=t.titleDiv,h=t.bgDiv,c=(s.style.width=e.container.clientWidth+"px",s.style.height=e.container.clientHeight+"px",e.container.appendChild(s),s.offsetWidth-r.offsetWidth);r.onmousedown=function(t){t=window.event||t;i=t.clientX-r.offsetLeft,document.onmousemove=function(t){t=window.event||t;(n=t.clientX-i)<0?n=0:c<n&&(n=c),r.style.left=n+"px",h.style.width=n+"px"},document.onmouseup=function(t){t=window.event||t;document.onmousemove=null,document.onmouseup=null,(n=t.clientX-i)<0?(n=0,a.innerHTML=e.title,o.callback(!1)):c<n?(n=c,a.innerHTML=e.success,r.innerHTML="√",r.onmousedown=null,o.callback(!0)):(o.callback(!1),n=0,r.style.transition="left .5s ease 0s",h.style.width="0",h.style.transition="width .5s ease 0s",r.addEventListener("transitionend",function(){r.style.transition="",h.style.transition=""})),r.style.left=n+"px"}}};var i=n;function n(t,e){this.callback=e,t.title||(t.title="滑动解锁"),t.success||(t.success="解锁成功"),this.init(t)}var r="width: 100%;\n    height: 40px;\n    border: 1px solid #e4e4e4;\n    background: #f7f7f7;\n    color: #666;\n    font-size: 14px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: relative;",o=(s.prototype.drawBg=function(){this.images&&0<this.images.length?this.getImg():(this.canvas.style.backgroundColor="#E8E8E8",this.draw())},s.prototype.getImg=function(){var t=this,e=this.images.length,e=Math.floor(Math.random()*e);this.bgImg.crossOrigin="Anonymous",this.bgImg.src=this.images[e],this.bgImg.onload=function(){t.draw()}},s.prototype.draw=function(){this.ctx.drawImage(this.bgImg,0,0,this.width,this.height);for(var t=0;t<this.fontNum;t++){var e=this.getRandomCharacter(this.fontStr),i=this.randomNum(20,+this.height/4),n=.5<Math.random()?"bold":"normal",o=.5<Math.random()?"italic":"normal",s=.5<Math.random()?"sans-serif":"serif",r=this.width/this.fontNum*t+10,a=Math.random()*(this.height-i);this.ctx.fillStyle=this.randomColor(0,255),this.ctx.font="".concat(o," ").concat(n," ").concat(i,"px ").concat(s),this.ctx.textBaseline="top",this.ctx.fillText(e,r,a),this.fontArr.push({character:e,x:r,y:a})}for(t=0;t<this.checkNum;t++){var h=Math.floor(Math.random()*this.fontArr.length),e=this.fontArr.splice(h,1)[0];this.tips.push(e)}this.addTips()},s.prototype.getRandomCharacter=function(t){var e=t.length,e=Math.floor(Math.random()*e),i=t.charAt(e);return this.fontArr.some(function(t){return t.character===i})?this.getRandomCharacter(t):i},s.prototype.randomColor=function(t,e){return"rgb("+this.randomNum(t,e)+","+this.randomNum(t,e)+","+this.randomNum(t,e)+")"},s.prototype.randomNum=function(t,e){return Math.floor(Math.random()*(e-t)+t)},s.prototype.createPointer=function(t){var e=this,i=t.offsetX-15,t=t.offsetY-15;this.pointer.length<this.tips.length&&(this.pointer.push({x:i,y:t}),this.state="active",this.addCheckIcon()),this.pointer.length===this.tips.length&&(this.verify()?this.state="success":(this.state="fail",this.timeIns=setTimeout(function(){e.reset()},1e3))),this.addTips()},s.prototype.verify=function(){var s=this,t=this.pointer.every(function(t,e){var i=t.x>s.tips[e].x-s.accuracy,n=t.x<s.tips[e].x+s.accuracy,o=t.y>s.tips[e].y-s.accuracy,t=t.y<s.tips[e].y+s.accuracy;return i&&n&&o&&t});return this.callback(t),t},s.prototype.reset=function(){this.fontArr=[],this.tips=[],this.pointer=[],this.state="",this.ctx.clearRect(0,0,this.width,this.height),this.drawBg(),this.pic.innerHTML="",this.pic.appendChild(this.canvas)},s.prototype.initView=function(){var t=document.createElement("div"),e=(t.style.cssText="position: relative;\n    overflow: hidden;\n    user-select:none;",t.style.width="".concat(this.width,"px"),this.createRefreshContainer()),i=this.createLayerContainer(),n=i.pic,i=i.canvas,o=this.createToolbar();return t.appendChild(e),t.appendChild(n),t.appendChild(o),{canvas:i,view:t,toolbar:o,layer:n}},s.prototype.createRefreshContainer=function(){var t=document.createElement("div");return t.style.cssText="display: flex;\n    position: absolute;\n    right: 10px;\n    top: 10px;\n    z-index: 2;\n    cursor: pointer;",t.onclick=this.reset.bind(this),t.innerHTML='<svg t="1637315258145" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2420" width="20" height="20"><path d="M960 416V192l-73.056 73.056a447.712 447.712 0 0 0-373.6-201.088C265.92 63.968 65.312 264.544 65.312 512S265.92 960.032 513.344 960.032a448.064 448.064 0 0 0 415.232-279.488 38.368 38.368 0 1 0-71.136-28.896 371.36 371.36 0 0 1-344.096 231.584C308.32 883.232 142.112 717.024 142.112 512S308.32 140.768 513.344 140.768c132.448 0 251.936 70.08 318.016 179.84L736 416h224z" p-id="2421" fill="#8a8a8a"></path></svg>',t},s.prototype.createLayerContainer=function(){var e=this,t=document.createElement("div"),i=(t.style.cssText="position: relative;",document.createElement("canvas"));return i.style.cssText="display: block;",i.onclick=function(t){return e.createPointer(t)},t.appendChild(i),{pic:t,canvas:i}},s.prototype.createToolbar=function(){var t=document.createElement("div");return t.style.cssText=r,t},s.prototype.addCheckIcon=function(){for(var t=0;t<this.pointer.length;t++){var e=this.pointer[t],i=e.x,e=e.y,n=document.createElement("div"),i=(n.style.cssText="background: #1abd6c;\n    border-radius: 50%;\n    padding: 10px;\n    position: absolute;",n.style.left="".concat(i,"px"),n.style.top="".concat(e,"px"),document.createElement("i"));i.style.cssText="color: #fff;\n    font-style: normal;\n    font-size: 12px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;",i.innerText="".concat(t+1),n.appendChild(i),this.pic.appendChild(n)}},s.prototype.addTips=function(){switch(this.toolbar.innerHTML="",this.state){case"active":this.toolbar.style.cssText+="color: #fff;\n    background: #1991FA;\n    border: 1px solid #1991FA;";var t=document.createElement("p"),e=document.createElement("span");e.innerText="请顺序点击【",t.appendChild(e);for(var i=0;i<this.tips.length;i++){var n=this.tips[i];(s=document.createElement("span")).innerText=n.character,t.appendChild(s)}e=document.createElement("span");e.innerText="】",t.appendChild(e),this.toolbar.appendChild(t);break;case"success":this.toolbar.style.cssText+="color: #fff;\n    background: #52CCBA;\n    border: 1px solid #52CCBA;";e=document.createElement("p");e.innerText="验证通过",this.toolbar.appendChild(e);break;case"fail":this.toolbar.style.cssText+="color: #fff;\n    background: #f57a7a;\n    border: 1px solid #f57a7a;";e=document.createElement("p");e.innerText="验证失败",this.toolbar.appendChild(e);break;default:this.toolbar.style.cssText=r;var o=document.createElement("p"),e=document.createElement("span");e.innerText="请顺序点击【",o.appendChild(e);for(i=0;i<this.tips.length;i++){var s,n=this.tips[i];(s=document.createElement("span")).innerText=n.character,o.appendChild(s)}e=document.createElement("span");e.innerText="】",o.appendChild(e),this.toolbar.appendChild(o)}},s);function s(t,e){this.fontArr=[],this.tips=[],this.pointer=[],this.state="",this.images=[],this.callback=e;var e=t.container,i=t.width,i=void 0===i?320:i,n=t.height,n=void 0===n?160:n,o=t.images,o=void 0===o?[]:o,s=t.fontStr,s=void 0===s?"1234567890":s,r=t.fontNum,r=void 0===r?5:r,a=t.checkNum,a=void 0===a?3:a,t=t.accuracy,t=void 0===t?15:t,o=(this.width=i,this.height=n,this.images=o,this.fontStr=s,this.fontNum=r,this.checkNum=a,this.accuracy=t,this.initView()),s=o.view,r=o.canvas,a=o.toolbar,t=o.layer;r.width=i,r.height=n,this.toolbar=a,this.pic=t,this.canvas=r,e.appendChild(s),this.ctx=r.getContext("2d"),this.bgImg=document.createElement("img"),this.drawBg()}function a(t,e){this.num1=0,this.num2=0,this.symbol="+",this.result=0,this.callback=e;var e=t.container,i=t.width,i=void 0===i?320:i,n=t.height,n=void 0===n?60:n,o=t.range,o=void 0===o?100:o,t=t.operator,t=void 0===t?["+","-"]:t,o=(this.width=i,this.height=n,this.range=o,this.operator=t,document.createElement("canvas")),t=(o.style.cssText="display: block;",o.width=i,o.height=n,o.onclick=this.reset.bind(this),this.ctx=o.getContext("2d"),document.createElement("div"));t.style.cssText="overflow: hidden; user-select: none; width: ".concat(this.width,"px;"),t.appendChild(o),e.appendChild(t),this.drawFormula()}return a.prototype.drawFormula=function(){this.ctx.fillStyle=this.randomColor(180,240),this.ctx.fillRect(0,0,this.width,this.height);for(var t=0;t<3;t++)this.ctx.strokeStyle=this.randomColor(40,180),this.ctx.beginPath(),this.ctx.moveTo(this.randomNum(0,this.width),this.randomNum(0,this.height)),this.ctx.lineTo(this.randomNum(0,this.width),this.randomNum(0,this.height)),this.ctx.stroke();for(var e=0;e<30;e++)this.ctx.fillStyle=this.randomColor(0,255),this.ctx.beginPath(),this.ctx.arc(this.randomNum(0,this.width),this.randomNum(0,this.height),1,0,2*Math.PI),this.ctx.fill();var i="";this.num1=Math.floor(Math.random()*this.range),this.num2=Math.floor(Math.random()*this.range),this.symbol=this.operator[Math.floor(2*Math.random())],"+"===this.symbol?(i="".concat(this.num1,"+").concat(this.num2,"=?"),this.result=this.num1+this.num2):(i=this.num1>=this.num2?"".concat(this.num1,"-").concat(this.num2,"=?"):"".concat(this.num2,"-").concat(this.num1,"=?"),this.result=Math.abs(this.num1-this.num2)),this.callback(this.result);for(var n=0;n<i.length;n++){this.ctx.fillStyle=this.randomColor(50,160),this.ctx.font=this.randomNum(2*this.height/4,3*this.height/4)+"px SimHei",this.ctx.textBaseline="top";var o=20+n*(this.width/i.length),s=this.randomNum(5,this.height/4);this.ctx.fillText(i[n],o,s)}},a.prototype.randomColor=function(t,e){return"rgb("+this.randomNum(t,e)+","+this.randomNum(t,e)+","+this.randomNum(t,e)+")"},a.prototype.randomNum=function(t,e){return Math.floor(Math.random()*(e-t)+t)},a.prototype.reset=function(){this.result=0,this.drawFormula()},{RandomBlock:t,Slider:i,TextClick:o,RandomCalc:a}});
