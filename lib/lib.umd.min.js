!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).lib=e()}(this,function(){"use strict";e.prototype.onClick=function(t,e,n){t.clearRect(0,0,e,n),this.draw(t,e,n)},e.prototype.randomRgb=function(){var t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(t,",").concat(e,",").concat(n,")")},e.prototype.randomChar=function(t){void 0===t&&(t=4);for(var e="",n=0;n<t;n++)e+=this.factorStr[Math.floor(Math.random()*this.factorStr.length)];return e},e.prototype.draw=function(t,e,n){if(t.strokeStyle=this.randomRgb(),this.isLine)for(var i=0;i<10;i++)t.beginPath(),t.moveTo(Math.random()*e,Math.random()*n),t.lineTo(Math.random()*e,Math.random()*n),t.strokeStyle=this.randomRgb(),t.stroke();if(this.isPoint)for(var o=0;o<20;o++){t.beginPath();var a=Math.random()*e,r=Math.random()*n;t.arc(a,r,1,0,2*Math.PI,!0),t.fillStyle=this.randomRgb(),t.fill()}for(var s="",c=0;c<this.charNum;c++){t.save();var a=e/this.charNum*c/2,r=Math.random()*n/4+n/4,h=(t.translate(a,r),this.randomChar(1));s+=h,t.font="italic ".concat(this.fontSize,"px 'Microsoft YaHei'"),this.isFill?(t.fillStyle=this.randomRgb(),t.fillText(h,a,r)):(t.strokeStyle=this.randomRgb(),t.strokeText(h,a,r)),t.restore()}this.callback(s)};var t=e;function e(t,e){var n=this,i=(this.callback=e,this.isLine=t.line,this.isPoint=t.point,this.isFill=t.fill,this.fontSize=t.fontSize||50,this.charNum=t.charNum||4,this.factorStr=t.factor||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",document.createElement("canvas")),o=(i.width=t.container.clientWidth,i.height=t.container.clientHeight,t.container.appendChild(i),i.getContext("2d"));i.onclick=function(){return n.onClick(o,i.width,i.height)},this.draw(o,i.width,i.height)}i.prototype.getMaterials=function(t){var e=document.createElement("div"),n=(e.style.cssText="user-select: none;\n    position: relative;\n    background-color: #E8E8E8;",document.createElement("div")),i=(n.style.cssText='position: absolute;\n    top: 0;\n    left: 0;\n    width: 36px;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: #fff;\n    cursor: pointer;\n    font-family: "宋体";\n    z-index: 1;\n    font-weight: bold;\n    color: #929292;',n.innerText=">>",document.createElement("div")),t=(i.style.cssText="position: absolute;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 13px;\n    color: #444;",i.innerText=t,document.createElement("div"));return t.style.cssText="background-color: #BFBFBF;\n    height: 100%;\n    position: absolute;\n    left: 0;",e.appendChild(t),e.appendChild(n),e.appendChild(i),{container:e,slider:n,titleDiv:i,bgDiv:t}},i.prototype.init=function(e){var n,i,o=this,t=this.getMaterials(e.title),a=t.container,r=t.slider,s=t.titleDiv,c=t.bgDiv,h=(a.style.width=e.container.clientWidth+"px",a.style.height=e.container.clientHeight+"px",e.container.appendChild(a),a.offsetWidth-r.offsetWidth);r.onmousedown=function(t){t=window.event||t;n=t.clientX-r.offsetLeft,document.onmousemove=function(t){t=window.event||t;(i=t.clientX-n)<0?i=0:h<i&&(i=h),r.style.left=i+"px",c.style.width=i+"px"},document.onmouseup=function(t){t=window.event||t;document.onmousemove=null,document.onmouseup=null,(i=t.clientX-n)<0?(i=0,s.innerHTML=e.title,o.callback(!1)):h<i?(i=h,s.innerHTML=e.success,r.innerHTML="√",r.onmousedown=null,o.callback(!0)):(o.callback(!1),i=0,r.style.transition="left .5s ease 0s",c.style.width="0",c.style.transition="width .5s ease 0s",r.addEventListener("transitionend",function(){r.style.transition="",c.style.transition=""})),r.style.left=i+"px"}}};var n=i;function i(t,e){this.callback=e,t.title||(t.title="滑动解锁"),t.success||(t.success="解锁成功"),this.init(t)}var r="width: 100%;\n    height: 40px;\n    border: 1px solid #e4e4e4;\n    background: #f7f7f7;\n    color: #666;\n    font-size: 14px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: relative;";function o(t,e){this.fontArr=[],this.tips=[],this.pointer=[],this.state="",this.images=[],this.callback=e;var e=t.container,n=t.width,n=void 0===n?320:n,i=t.height,i=void 0===i?160:i,o=t.images,o=void 0===o?[]:o,a=t.fontStr,a=void 0===a?"1234567890":a,r=t.fontNum,r=void 0===r?5:r,s=t.checkNum,s=void 0===s?3:s,t=t.accuracy,t=void 0===t?15:t,o=(this.width=n,this.height=i,this.images=o,this.fontStr=a,this.fontNum=r,this.checkNum=s,this.accuracy=t,this.initView()),a=o.view,r=o.canvas,s=o.toolbar,t=o.layer;r.width=n,r.height=i,this.toolbar=s,this.pic=t,this.canvas=r,e.appendChild(a),this.ctx=r.getContext("2d"),this.bgImg=document.createElement("img"),this.drawBg()}return o.prototype.drawBg=function(){this.images&&0<this.images.length?this.getImg():(this.canvas.style.backgroundColor="#E8E8E8",this.draw())},o.prototype.getImg=function(){var t=this,e=this.images.length,e=Math.floor(Math.random()*e);this.bgImg.crossOrigin="Anonymous",this.bgImg.src=this.images[e],this.bgImg.onload=function(){t.draw()}},o.prototype.draw=function(){this.ctx.drawImage(this.bgImg,0,0,this.width,this.height);for(var t=0;t<this.fontNum;t++){var e=this.getRandomCharacter(this.fontStr),n=this.randomNum(20,+this.height/4),i=.5<Math.random()?"bold":"normal",o=.5<Math.random()?"italic":"normal",a=.5<Math.random()?"sans-serif":"serif",r=this.width/this.fontNum*t+10,s=Math.random()*(this.height-n);this.ctx.fillStyle=this.randomColor(0,255),this.ctx.font="".concat(o," ").concat(i," ").concat(n,"px ").concat(a),this.ctx.textBaseline="top",this.ctx.fillText(e,r,s),this.fontArr.push({character:e,x:r,y:s})}for(t=0;t<this.checkNum;t++){var c=Math.floor(Math.random()*this.fontArr.length),e=this.fontArr.splice(c,1)[0];this.tips.push(e)}this.addTips()},o.prototype.getRandomCharacter=function(t){var e=t.length,e=Math.floor(Math.random()*e),n=t.charAt(e);return this.fontArr.some(function(t){return t.character===n})?this.getRandomCharacter(t):n},o.prototype.randomColor=function(t,e){return"rgb("+this.randomNum(t,e)+","+this.randomNum(t,e)+","+this.randomNum(t,e)+")"},o.prototype.randomNum=function(t,e){return Math.floor(Math.random()*(e-t)+t)},o.prototype.createPointer=function(t){var e=this,n=t.offsetX-15,t=t.offsetY-15;this.pointer.length<this.tips.length&&(this.pointer.push({x:n,y:t}),this.state="active",this.addCheckIcon()),this.pointer.length===this.tips.length&&(this.verify()?this.state="success":(this.state="fail",this.timeIns=setTimeout(function(){e.reset()},1e3))),this.addTips()},o.prototype.verify=function(){var a=this,t=this.pointer.every(function(t,e){var n=t.x>a.tips[e].x-a.accuracy,i=t.x<a.tips[e].x+a.accuracy,o=t.y>a.tips[e].y-a.accuracy,t=t.y<a.tips[e].y+a.accuracy;return n&&i&&o&&t});return this.callback(t),t},o.prototype.reset=function(){this.fontArr=[],this.tips=[],this.pointer=[],this.state="",this.ctx.clearRect(0,0,this.width,this.height),this.drawBg(),this.pic.innerHTML="",this.pic.appendChild(this.canvas)},o.prototype.initView=function(){var t=document.createElement("div"),e=(t.style.cssText="position: relative;\n    overflow: hidden;\n    user-select:none;",t.style.width="".concat(this.width,"px"),this.createRefreshContainer()),n=this.createLayerContainer(),i=n.pic,n=n.canvas,o=this.createToolbar();return t.appendChild(e),t.appendChild(i),t.appendChild(o),{canvas:n,view:t,toolbar:o,layer:i}},o.prototype.createRefreshContainer=function(){var t=document.createElement("div");return t.style.cssText="display: flex;\n    position: absolute;\n    right: 10px;\n    top: 10px;\n    z-index: 2;\n    cursor: pointer;",t.onclick=this.reset.bind(this),t.innerHTML='<svg t="1637315258145" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2420" width="20" height="20"><path d="M960 416V192l-73.056 73.056a447.712 447.712 0 0 0-373.6-201.088C265.92 63.968 65.312 264.544 65.312 512S265.92 960.032 513.344 960.032a448.064 448.064 0 0 0 415.232-279.488 38.368 38.368 0 1 0-71.136-28.896 371.36 371.36 0 0 1-344.096 231.584C308.32 883.232 142.112 717.024 142.112 512S308.32 140.768 513.344 140.768c132.448 0 251.936 70.08 318.016 179.84L736 416h224z" p-id="2421" fill="#8a8a8a"></path></svg>',t},o.prototype.createLayerContainer=function(){var e=this,t=document.createElement("div"),n=(t.style.cssText="position: relative;",document.createElement("canvas"));return n.style.cssText="display: block;",n.onclick=function(t){return e.createPointer(t)},t.appendChild(n),{pic:t,canvas:n}},o.prototype.createToolbar=function(){var t=document.createElement("div");return t.style.cssText=r,t},o.prototype.addCheckIcon=function(){for(var t=0;t<this.pointer.length;t++){var e=this.pointer[t],n=e.x,e=e.y,i=document.createElement("div"),n=(i.style.cssText="background: #1abd6c;\n    border-radius: 50%;\n    padding: 10px;\n    position: absolute;",i.style.left="".concat(n,"px"),i.style.top="".concat(e,"px"),document.createElement("i"));n.style.cssText="color: #fff;\n    font-style: normal;\n    font-size: 12px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;",n.innerText="".concat(t+1),i.appendChild(n),this.pic.appendChild(i)}},o.prototype.addTips=function(){switch(this.toolbar.innerHTML="",this.state){case"active":this.toolbar.style.cssText+="color: #fff;\n    background: #1991FA;\n    border: 1px solid #1991FA;";var t=document.createElement("p"),e=document.createElement("span");e.innerText="请顺序点击【",t.appendChild(e);for(var n=0;n<this.tips.length;n++){var i=this.tips[n];(a=document.createElement("span")).innerText=i.character,t.appendChild(a)}e=document.createElement("span");e.innerText="】",t.appendChild(e),this.toolbar.appendChild(t);break;case"success":this.toolbar.style.cssText+="color: #fff;\n    background: #52CCBA;\n    border: 1px solid #52CCBA;";e=document.createElement("p");e.innerText="验证通过",this.toolbar.appendChild(e);break;case"fail":this.toolbar.style.cssText+="color: #fff;\n    background: #f57a7a;\n    border: 1px solid #f57a7a;";e=document.createElement("p");e.innerText="验证失败",this.toolbar.appendChild(e);break;default:this.toolbar.style.cssText=r;var o=document.createElement("p"),e=document.createElement("span");e.innerText="请顺序点击【",o.appendChild(e);for(n=0;n<this.tips.length;n++){var a,i=this.tips[n];(a=document.createElement("span")).innerText=i.character,o.appendChild(a)}e=document.createElement("span");e.innerText="】",o.appendChild(e),this.toolbar.appendChild(o)}},{RandomBlock:t,Slider:n,TextClick:o}});
